@page "/"
@using Demo.ApiClient;
@using Demo.ApiClient.Models.ApiModels
@inject DemoApiClientService ApiClientService;


<h3>Products</h3>

<div class="card">
	<div class="card-body p-0">

	<table class="table table-bordered table-striped">
		<thead>
		<tr>
			<th>Product Code</th>
			<th>Product Name</th>
			<th>Price</th>
			<th style="width:180px;">Actions</th>
		</tr>
		</thead>

		<tbody>
		<!-- Row for new product -->
		<tr>
			<td>
				<input class="form-control" @bind="_addProductModel.ProductCode" />
			</td>
			<td>
				<input class="form-control" @bind="_addProductModel.ProductName" />
			</td>
			<td>
				<input class="form-control" type="number" step="0.01" @bind="_addProductModel.Price" />
			</td>
			<td>
				<button class="btn btn-primary" @onclick="AddProduct">Save</button>
			</td>
		</tr>

		<!-- Display all products using separated component -->
		@if (_products?.Any() ?? false)
		{
			@foreach (var product in _products)
			{
				<ProductRowItemComponent
					Product="product"
					OnUpdate="EditProduct"
					OnDelete="DeleteProduct"/>
			}
		}
		else
		{
			<tr>
				<td class="text-center" colspan="3">= No Products</td>
			</tr>
		}
		</tbody>
	</table>
	
	</div>
</div>

@code
{
	private List<Product>? _products;
	private Product _addProductModel = new();

	protected override async Task OnInitializedAsync()
	{
		await LoadProducts();
	}

	private async Task LoadProducts()
	{
		_products = await ApiClientService.GetProductsAsync();
	}

	private async Task AddProduct()
	{
		await ApiClientService.SaveProduct(_addProductModel);
		await LoadProducts();
		_addProductModel = new();
	}

	private async Task EditProduct(Product product)
	{
		await ApiClientService.UpdateProduct(product);
		await LoadProducts();
	}

	private async Task DeleteProduct(int id)
	{
		await ApiClientService.DeleteProduct(id);
		await LoadProducts();
	}

}
